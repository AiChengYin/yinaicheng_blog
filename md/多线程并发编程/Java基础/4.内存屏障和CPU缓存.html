<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内存屏障和CPU缓存 | 印爱成的IT技术分享</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/yinaicheng_blog/myWebStie.ico">
    <script charset="utf-8" async="async" src="/yinaicheng_blog/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/yinaicheng_blog/js/global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <script>
            (function(){
              if(location.href.indexOf('/yinaicheng_blog/project') > -1){
                const target = 'https://aichengyin.github.io/yinaicheng_blog/md/プロジェクト紹介/上海咪啰信息科技有限公司/1.洋⼭四期⼤数据運営効率分析システム.html';
                location.href = encodeURI(target);
              }
            })();
         </script>
    <meta name="description" content="算法、并发编程、分布式、中间件、关系型数据库、云原生...">
    <meta name="robots" content="all">
    <meta name="author" content="印爱成">
    <meta name="title" content="IT技术分享">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="算法、并发编程、分布式、中间件、关系型数据库、云原生...">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/yinaicheng_blog/assets/css/0.styles.1a44adbb.css" as="style"><link rel="preload" href="/yinaicheng_blog/assets/js/app.5380c28c.js" as="script"><link rel="preload" href="/yinaicheng_blog/assets/js/4.b49c4393.js" as="script"><link rel="preload" href="/yinaicheng_blog/assets/js/146.01503219.js" as="script"><link rel="preload" href="/yinaicheng_blog/assets/js/1.afcb60e2.js" as="script"><link rel="prefetch" href="/yinaicheng_blog/assets/js/100.b02360db.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/101.94e3c053.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/102.9a2d83cc.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/103.8be54794.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/104.7925d4f8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/105.c2b9ccc4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/106.5f21e39c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/107.1d217afe.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/108.9b373a0c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/109.d5bf89bd.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/11.c4a314ae.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/110.9406d63e.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/111.db819e8a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/112.a2de1eff.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/113.5d19f5fd.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/114.4ad552a4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/115.f50c36f7.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/116.3d616ec6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/117.2b76e395.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/118.25ec1715.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/119.caafe5f5.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/12.b37c5f15.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/120.ac4d706a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/121.1a2032d3.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/122.ba53c02b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/123.5d615ea2.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/124.700c2d8d.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/125.cdcb13b7.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/126.e148926c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/127.9af9c63f.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/128.0609c024.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/129.52533a02.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/13.e3c5c39c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/130.a40e5183.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/131.ff404960.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/132.6970c7b7.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/133.afa46de0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/134.4dc5d269.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/135.285a5f4c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/136.832135b1.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/137.8364ee77.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/138.2cb63656.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/139.bca4b336.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/14.6f34ea63.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/140.5c02fc19.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/141.f1b0d9a9.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/142.2787ff05.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/143.48302fa0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/144.06c46448.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/145.834adff9.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/147.c802007c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/148.01876c2c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/149.f7f64551.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/15.f46a720e.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/150.057a8f95.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/151.bdee161f.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/152.466b0ac8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/153.b64ec4c4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/154.b87c6513.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/155.764ece04.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/156.d3a0b5e4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/157.d0ae051b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/158.bd886174.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/159.3919c43e.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/16.84394c50.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/160.6169aea8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/161.1b1caf71.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/162.0d00117b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/163.a2eb2fbf.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/164.c84c41c6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/165.427ed156.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/166.53efe6dd.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/167.b1a5fe7b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/168.a6a68139.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/169.2b7f7fe2.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/17.5396bd3a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/170.5bb6ef67.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/171.c4add897.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/18.0e249471.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/19.0a7f0d04.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/2.5d964f3b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/20.1cecd0a8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/21.25bc5a76.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/22.2bbdebd6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/23.aa4b93f2.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/24.ee73d472.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/25.997a8845.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/26.3edcbc63.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/27.9c760ba4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/28.2783797b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/29.aa069463.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/3.f7d9ee57.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/30.a0fac2b3.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/31.1d2fc6af.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/32.3485c4d0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/33.29776f33.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/34.d91acea7.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/35.235e7b5d.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/36.d1118d64.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/37.2a4c6f45.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/38.cf5d4cc8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/39.8ee49966.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/40.e8325df5.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/41.51aa9d74.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/42.3d97fc15.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/43.6567c19d.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/44.b1f757c4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/45.81e478ee.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/46.95e69e31.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/47.5c15fa85.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/48.df7c14f3.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/49.e44c5fc1.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/5.2663edae.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/50.bad52c50.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/51.5f3191ba.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/52.edd4b1ac.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/53.cb7b479b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/54.f7de3cc9.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/55.ae52e307.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/56.f1fb7ded.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/57.b810bd8b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/58.2337fcd8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/59.d340435a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/6.893ae9e4.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/60.58b26f79.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/61.4c9415f5.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/62.71f34266.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/63.b268f9a0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/64.64a9298e.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/65.7a550b03.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/66.9c4668ab.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/67.afb695c6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/68.b0b7a856.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/69.eafe3b11.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/7.89c91f9a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/70.8e9bfdb3.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/71.7a733246.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/72.eb17ed40.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/73.25bde646.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/74.5d44bcc8.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/75.48effe80.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/76.a55fec49.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/77.eeff4c9a.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/78.93870f70.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/79.decc7f1e.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/8.0938ca70.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/80.5e5d819c.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/81.60b06db0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/82.2044d3d1.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/83.9cac6103.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/84.90bd5d88.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/85.7aeb087d.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/86.a610de12.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/87.673e4fb6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/88.ec4fd24f.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/89.f5853163.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/90.e73a93a0.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/91.4a236062.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/92.0d6c05dd.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/93.99bc24a2.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/94.2ac022b6.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/95.e5ae5770.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/96.5eea62ab.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/97.60ead988.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/98.d03b8690.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/99.d9d4725b.js"><link rel="prefetch" href="/yinaicheng_blog/assets/js/vendors~docsearch.367d7555.js">
    <link rel="stylesheet" href="/yinaicheng_blog/assets/css/0.styles.1a44adbb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yinaicheng_blog/" class="home-link router-link-active"><!----> <span class="site-name">印爱成的IT技术分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="プロジェクト紹介" class="dropdown-title"><span class="title">プロジェクト紹介</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/プロジェクト紹介/上海咪啰信息科技有限公司/1.洋⼭四期⼤数据運営効率分析システム.html" class="nav-link">
  上海咪啰信息科技有限公司
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/プロジェクト紹介/⽹易（杭州）⽹络有限公司/1.⽹易数帆（クラウド公共プラットフォーム）CMS∕ミニアプリ開発.html" class="nav-link">
  ⽹易（杭州）⽹络有限公司
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法与数据结构" class="dropdown-title"><span class="title">算法与数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/算法与数据结构/算法/1.算法概述.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/算法与数据结构/数据结构/1.数据结构概述.html" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关系型数据库" class="dropdown-title"><span class="title">关系型数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/关系型数据库/Mysql/1.MySQL简介.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="多线程并发编程" class="dropdown-title"><span class="title">多线程并发编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/多线程并发编程/Java基础/1.Java程序运行原理分析.html" class="nav-link">
  Java基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高并发网络编程" class="dropdown-title"><span class="title">高并发网络编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/高并发网络编程/Java网络编程/1.TCP_UDP协议.html" class="nav-link">
  Java网络编程
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/Linux/Centos/常用操作/常用操作.html" class="nav-link">
  Centos
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/Linux/Ubuntu/常用操作/常用操作.html" class="nav-link">
  Ubuntu
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/框架/Spring框架/Spring介绍.html" class="nav-link">
  Spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/准备工作/使用nvm管理不同版本的 node与npm.html" class="nav-link">
  准备工作
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/前后端分离与工程化/前后端分离与工程化.html" class="nav-link">
  前后端分离与工程化
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/前端性能优化/前端性能优化.html" class="nav-link">
  前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/基础前端技术/基础前端技术.html" class="nav-link">
  基础前端技术
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/框架和工具/框架和工具.html" class="nav-link">
  框架和工具
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/浏览器兼容性与安全性/浏览器兼容性与安全性.html" class="nav-link">
  浏览器兼容性与安全性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/Java开发经验/Java开发经验.html" class="nav-link">
  Java开发经验
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/框架和工具链/框架和工具链.html" class="nav-link">
  框架和工具链
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/关系型数据库/关系型数据库.html" class="nav-link">
  关系型数据库
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/NoSQL数据库/NoSQL数据库.html" class="nav-link">
  NoSQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/RESTful的API/RESTful的API.html" class="nav-link">
  RESTful的API
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/分布式系统及微服务架构/分布式系统及微服务架构.html" class="nav-link">
  分布式系统及微服务架构
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/消息队列系统/消息队列系统.html" class="nav-link">
  消息队列系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式消息中间件" class="dropdown-title"><span class="title">分布式消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/分布式消息中间件/ActiveMQ/1.JMS概述.html" class="nav-link">
  ActiveMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="负载均衡中间件" class="dropdown-title"><span class="title">负载均衡中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/负载均衡中间件/Nginx/1.Nginx负载均衡.html" class="nav-link">
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式文件存储" class="dropdown-title"><span class="title">分布式文件存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/分布式文件存储/MinIO/1.介绍.html" class="nav-link">
  MinIO
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码版本控制" class="dropdown-title"><span class="title">代码版本控制</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/代码版本控制/Git/1.Git版本控制入门.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/代码版本控制/JitPack/JitPack.html" class="nav-link">
  JitPack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/面试/华为/机考/注意事项.html" class="nav-link">
  华为
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><span class="title">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/AI/ChatGPT/ChatGPT使用.html" class="nav-link">
  ChatGPT
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="外语" class="dropdown-title"><span class="title">外语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/新标日初级/1.第一课.html" class="nav-link">
  新标日初级
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/日语学习语法全掌握/1.名词谓语句.html" class="nav-link">
  日语学习语法全掌握
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/TRYN2语法必备/1.名词+につき.html" class="nav-link">
  TRYN2语法必备
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="プロジェクト紹介" class="dropdown-title"><span class="title">プロジェクト紹介</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/プロジェクト紹介/上海咪啰信息科技有限公司/1.洋⼭四期⼤数据運営効率分析システム.html" class="nav-link">
  上海咪啰信息科技有限公司
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/プロジェクト紹介/⽹易（杭州）⽹络有限公司/1.⽹易数帆（クラウド公共プラットフォーム）CMS∕ミニアプリ開発.html" class="nav-link">
  ⽹易（杭州）⽹络有限公司
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法与数据结构" class="dropdown-title"><span class="title">算法与数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/算法与数据结构/算法/1.算法概述.html" class="nav-link">
  算法
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/算法与数据结构/数据结构/1.数据结构概述.html" class="nav-link">
  数据结构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关系型数据库" class="dropdown-title"><span class="title">关系型数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/关系型数据库/Mysql/1.MySQL简介.html" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="多线程并发编程" class="dropdown-title"><span class="title">多线程并发编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/多线程并发编程/Java基础/1.Java程序运行原理分析.html" class="nav-link">
  Java基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高并发网络编程" class="dropdown-title"><span class="title">高并发网络编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/高并发网络编程/Java网络编程/1.TCP_UDP协议.html" class="nav-link">
  Java网络编程
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/Linux/Centos/常用操作/常用操作.html" class="nav-link">
  Centos
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/Linux/Ubuntu/常用操作/常用操作.html" class="nav-link">
  Ubuntu
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/框架/Spring框架/Spring介绍.html" class="nav-link">
  Spring
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/准备工作/使用nvm管理不同版本的 node与npm.html" class="nav-link">
  准备工作
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/前后端分离与工程化/前后端分离与工程化.html" class="nav-link">
  前后端分离与工程化
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/前端性能优化/前端性能优化.html" class="nav-link">
  前端性能优化
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/基础前端技术/基础前端技术.html" class="nav-link">
  基础前端技术
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/框架和工具/框架和工具.html" class="nav-link">
  框架和工具
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/前端/浏览器兼容性与安全性/浏览器兼容性与安全性.html" class="nav-link">
  浏览器兼容性与安全性
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/Java开发经验/Java开发经验.html" class="nav-link">
  Java开发经验
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/框架和工具链/框架和工具链.html" class="nav-link">
  框架和工具链
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/关系型数据库/关系型数据库.html" class="nav-link">
  关系型数据库
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/NoSQL数据库/NoSQL数据库.html" class="nav-link">
  NoSQL数据库
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/RESTful的API/RESTful的API.html" class="nav-link">
  RESTful的API
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/分布式系统及微服务架构/分布式系统及微服务架构.html" class="nav-link">
  分布式系统及微服务架构
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/后端/消息队列系统/消息队列系统.html" class="nav-link">
  消息队列系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式消息中间件" class="dropdown-title"><span class="title">分布式消息中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/分布式消息中间件/ActiveMQ/1.JMS概述.html" class="nav-link">
  ActiveMQ
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="负载均衡中间件" class="dropdown-title"><span class="title">负载均衡中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/负载均衡中间件/Nginx/1.Nginx负载均衡.html" class="nav-link">
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式文件存储" class="dropdown-title"><span class="title">分布式文件存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/分布式文件存储/MinIO/1.介绍.html" class="nav-link">
  MinIO
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码版本控制" class="dropdown-title"><span class="title">代码版本控制</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/代码版本控制/Git/1.Git版本控制入门.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/代码版本控制/JitPack/JitPack.html" class="nav-link">
  JitPack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/面试/华为/机考/注意事项.html" class="nav-link">
  华为
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="AI" class="dropdown-title"><span class="title">AI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/AI/ChatGPT/ChatGPT使用.html" class="nav-link">
  ChatGPT
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="外语" class="dropdown-title"><span class="title">外语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/新标日初级/1.第一课.html" class="nav-link">
  新标日初级
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/日语学习语法全掌握/1.名词谓语句.html" class="nav-link">
  日语学习语法全掌握
</a></li><li class="dropdown-item"><!----> <a href="/yinaicheng_blog/md/外语/日语/TRYN2语法必备/1.名词+につき.html" class="nav-link">
  TRYN2语法必备
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/1.Java程序运行原理分析.html" class="sidebar-link">Java程序运行原理分析</a></li><li><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/2.线程状态.html" class="sidebar-link">线程状态</a></li><li><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/3.线程中止.html" class="sidebar-link">线程中止</a></li><li><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/4.内存屏障和CPU缓存.html" class="active sidebar-link">内存屏障和CPU缓存</a></li><li><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/5.线程通信.html" class="sidebar-link">线程通信</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h1 id="内存屏障和cpu缓存"><a href="#内存屏障和cpu缓存" class="header-anchor">#</a> 内存屏障和CPU缓存</h1> <p>聊一聊 CPU 缓存、指令重排和内存屏障。</p> <hr> <h2 id="一、cpu-为什么要搞缓存"><a href="#一、cpu-为什么要搞缓存" class="header-anchor">#</a> 一、CPU 为什么要搞缓存</h2> <blockquote><p><strong>CPU 太快，内存太慢，不加缓存 CPU 会被活活拖死。</strong></p></blockquote> <p>CPU 一个时钟周期就能干很多事，但如果每次都要等内存返回数据，那 CPU 大部分时间都在“发呆”。<br>
于是硬件工程师给 CPU 安排了一个“随身小仓库”——<strong>CPU Cache</strong>。</p> <p>核心思想很简单：</p> <ul><li>常用数据放近点</li> <li>能不访问内存就不访问</li> <li>用空间换时间</li></ul> <p>这也是为什么你会看到：</p> <blockquote><p>CPU 主频越来越高，但程序性能提升却没那么明显<br>
因为瓶颈早就不在算力，而在<strong>内存访问</strong>。</p></blockquote> <hr> <h2 id="二、多级缓存是怎么一回事"><a href="#二、多级缓存是怎么一回事" class="header-anchor">#</a> 二、多级缓存是怎么一回事</h2> <p>CPU 缓存不是一层，而是分了好几层：</p> <ul><li><strong>L1 Cache</strong> <ul><li>离 CPU 最近</li> <li>速度最快</li> <li>容量最小</li></ul></li> <li><strong>L2 Cache</strong> <ul><li>次近</li> <li>稍慢</li></ul></li> <li><strong>L3 Cache</strong> <ul><li>多个 CPU 核共享</li> <li>容量最大，但也最慢</li></ul></li></ul> <p>可以粗暴理解为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CPU 核心
  ↓
L1（极快）
  ↓
L2（很快）
  ↓
L3（还行）
  ↓
内存（慢）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>越靠近 CPU：</p> <ul><li>速度越快</li> <li>容量越小</li> <li>成本越高</li></ul> <hr> <h2 id="三、多核下的数据一致性问题"><a href="#三、多核下的数据一致性问题" class="header-anchor">#</a> 三、多核下的数据一致性问题</h2> <p>单核时代基本不用操心缓存一致性。
但现在是<strong>多核 CPU + 多线程并发</strong>。</p> <p>问题来了：</p> <ul><li>每个 CPU 核都有自己的缓存</li> <li>A 核改了数据</li> <li>B 核还在用旧数据</li></ul> <p>这显然不行。</p> <h3 id="缓存一致性协议-mesi"><a href="#缓存一致性协议-mesi" class="header-anchor">#</a> 缓存一致性协议（MESI）</h3> <p>为了解决这个问题，CPU 引入了缓存一致性协议，比如 <strong>MESI</strong>。</p> <p>记住结论：</p> <blockquote><p><strong>一个核心改数据，其他核心必须知道，并且不能继续用旧缓存。</strong></p></blockquote> <p>常见做法是：</p> <ul><li>修改数据的核心发广播</li> <li>其他核心把对应缓存行标记为失效</li> <li>下次用的时候重新加载</li></ul> <p>这保证了：</p> <ul><li>最终一致</li> <li>但不是实时一致</li></ul> <p>也正是这里，给并发 Bug 留了空间。</p> <hr> <h2 id="四、cpu-的另一个骚操作-指令重排"><a href="#四、cpu-的另一个骚操作-指令重排" class="header-anchor">#</a> 四、CPU 的另一个骚操作：指令重排</h2> <p>缓存解决的是“读写慢”的问题。
<strong>指令重排</strong>解决的是“CPU 空等”的问题。</p> <p>CPU 和编译器非常聪明，只要<strong>不影响单线程结果</strong>，它们就会调整执行顺序。</p> <p>比如你写的是：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>CPU 可能执行成：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>只要单线程看不出区别，它就觉得完全 OK。</p> <p>问题是：<br>
👉 <strong>多线程不这么想。</strong></p> <hr> <h2 id="五、缓存-指令重排带来的并发问题"><a href="#五、缓存-指令重排带来的并发问题" class="header-anchor">#</a> 五、缓存 + 指令重排带来的并发问题</h2> <p>经典翻车现场：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 线程 A</span>
value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 线程 B</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>你以为的执行顺序：</p> <ol><li>value = 42</li> <li>flag = true</li> <li>B 看到 flag 为 true</li> <li>B 一定能看到 value = 42</li></ol> <p>但实际可能是：</p> <ul><li>指令被重排</li> <li>写操作还在缓存里</li> <li>B 线程读到了 flag，但 value 还没同步</li></ul> <p>结果就是：</p> <ul><li>flag == true</li> <li>value == 0</li></ul> <p>👉 <strong>这不是 Java 写错了，是 CPU 太积极了。</strong></p> <hr> <h2 id="六、内存屏障-让-cpu-老实一点"><a href="#六、内存屏障-让-cpu-老实一点" class="header-anchor">#</a> 六、内存屏障：让 CPU 老实一点</h2> <p>这时候就轮到 <strong>内存屏障（Memory Barrier）</strong> 出场了。</p> <p>你可以把它理解成：</p> <blockquote><p><strong>“这里是关键位置，不准乱来！”</strong></p></blockquote> <p>内存屏障能干三件事：</p> <ol><li>禁止特定的指令重排</li> <li>强制刷新或失效缓存</li> <li>保证多线程可见性</li></ol> <h3 id="java-里你怎么用到内存屏障的"><a href="#java-里你怎么用到内存屏障的" class="header-anchor">#</a> Java 里你怎么用到内存屏障的？</h3> <p>你一般不会手写内存屏障，但你天天在用它的“马甲”：</p> <h4 id="volatile"><a href="#volatile" class="header-anchor">#</a> volatile</h4> <ul><li>写 volatile：前面的写必须先完成</li> <li>读 volatile：后面的读不能提前</li></ul> <h4 id="synchronized"><a href="#synchronized" class="header-anchor">#</a> synchronized</h4> <ul><li>进入同步块：相当于读屏障</li> <li>退出同步块：相当于写屏障</li></ul> <h4 id="final"><a href="#final" class="header-anchor">#</a> final</h4> <ul><li>构造完成后，保证其他线程能看到正确值</li></ul> <p>一句话总结：</p> <blockquote><p><strong>JMM 本质上就是一套“内存屏障使用说明书”。</strong></p></blockquote> <hr> <h2 id="七、结语-一点经验之谈"><a href="#七、结语-一点经验之谈" class="header-anchor">#</a> 七、结语 &amp; 一点经验之谈</h2> <p>最后用几句人话收尾：</p> <ul><li>CPU 缓存是为了快</li> <li>指令重排是为了更快</li> <li>多线程问题，是“快”带来的副作用</li> <li>内存屏障不是性能敌人
<ul><li>而是<strong>在关键点踩刹车</strong></li></ul></li></ul> <p>写并发代码时：</p> <ul><li>不要迷信“看起来没问题”</li> <li>volatile、synchronized 不是玄学</li> <li>很多 Bug，本质是你和 CPU 在“斗智斗勇”</li></ul> <p>理解了缓存和内存屏障：</p> <ul><li>你会更敬畏 volatile</li> <li>更理解 JMM</li> <li>也更容易写出<strong>稳定而不是侥幸运行</strong>的并发代码</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/yinaicheng_blog/md/多线程并发编程/Java基础/3.线程中止.html" class="prev">
          线程中止
        </a></span> <span class="next"><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/5.线程通信.html">
          线程通信
        </a>
        →
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">内存屏障和CPU缓存</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#一、cpu-为什么要搞缓存" class="toc-sidebar-link">一、CPU 为什么要搞缓存</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#二、多级缓存是怎么一回事" class="toc-sidebar-link">二、多级缓存是怎么一回事</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#三、多核下的数据一致性问题" class="toc-sidebar-link">三、多核下的数据一致性问题</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#缓存一致性协议-mesi" class="toc-sidebar-link">缓存一致性协议（MESI）</a></li></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#四、cpu-的另一个骚操作-指令重排" class="toc-sidebar-link">四、CPU 的另一个骚操作：指令重排</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#五、缓存-指令重排带来的并发问题" class="toc-sidebar-link">五、缓存 + 指令重排带来的并发问题</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#六、内存屏障-让-cpu-老实一点" class="toc-sidebar-link">六、内存屏障：让 CPU 老实一点</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#java-里你怎么用到内存屏障的" class="toc-sidebar-link">Java 里你怎么用到内存屏障的？</a></li></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#七、结语-一点经验之谈" class="toc-sidebar-link">七、结语 &amp; 一点经验之谈</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">内存屏障和CPU缓存</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#一、cpu-为什么要搞缓存" class="toc-sidebar-link">一、CPU 为什么要搞缓存</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#二、多级缓存是怎么一回事" class="toc-sidebar-link">二、多级缓存是怎么一回事</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#三、多核下的数据一致性问题" class="toc-sidebar-link">三、多核下的数据一致性问题</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#缓存一致性协议-mesi" class="toc-sidebar-link">缓存一致性协议（MESI）</a></li></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#四、cpu-的另一个骚操作-指令重排" class="toc-sidebar-link">四、CPU 的另一个骚操作：指令重排</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#五、缓存-指令重排带来的并发问题" class="toc-sidebar-link">五、缓存 + 指令重排带来的并发问题</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#六、内存屏障-让-cpu-老实一点" class="toc-sidebar-link">六、内存屏障：让 CPU 老实一点</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#java-里你怎么用到内存屏障的" class="toc-sidebar-link">Java 里你怎么用到内存屏障的？</a></li></ul></li><li><a href="/yinaicheng_blog/md/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/Java%E5%9F%BA%E7%A1%80/4.%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C%E5%92%8CCPU%E7%BC%93%E5%AD%98.html#七、结语-一点经验之谈" class="toc-sidebar-link">七、结语 &amp; 一点经验之谈</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div title="线程中止" class="option-box" style="padding-left:2px;text-align:center;"><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/3.线程中止.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <div title="线程通信" class="option-box" style="padding-left:2px;text-align:center;"><a href="/yinaicheng_blog/md/多线程并发编程/Java基础/5.线程通信.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div>  <!----> </aside></div><div class="global-ui"></div></div>
    <script src="/yinaicheng_blog/assets/js/app.5380c28c.js" defer></script><script src="/yinaicheng_blog/assets/js/4.b49c4393.js" defer></script><script src="/yinaicheng_blog/assets/js/146.01503219.js" defer></script><script src="/yinaicheng_blog/assets/js/1.afcb60e2.js" defer></script>
  </body>
</html>
