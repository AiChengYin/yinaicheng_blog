## 安装Docker

### 环境要求及版本

系统环境：Centos Linux release 7

### 安装步骤

```text
使用yum安装
执行以下命令安装依赖包
sudo yum install -y yum-utils
鉴于国内网络环境，使用国内源
sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sudo sed -i 's/download.docker.com/mirrors.aliyun.com\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo
安装Docker
更新 yum 软件源缓存，并安装 docker-ce
sudo yum install docker-ce docker-ce-cli containerd.io
```

### 查看Docker版本

```text
docker version
/*如果安装成功，可以得到类似如下结果*/
Client version: 1.7.1
Client API version: 1.19
Go version (client): go1.4.2
Git commit (client): 786b29d
OS/Arch (client): linux/amd64
```

### Docker设置国内镜像源

手动先进入etc目录下:

```text
cd /etc/
```

手动创docker建文件夹并且进入docker文件夹：

```text
mkdir docker/
cd docker/
```

创建daemon.json文件并且进入编辑：

```text
vi /etc/docker/daemon.json
```

进入vi图形界面，增添：

```text
{
    "registry-mirrors": ["http://hub-mirror.c.163.com"]
}
或者自己的镜像加速器，如
{
    "registry-mirrors": ["https://0d3bq9mn.mirror.aliyuncs.com"]
}
```

重新加载配置文件：

```text
systemctl daemon-reload
```

### 启动docker服务

```text
systemctl start docker.service
```

### docker的/var/lib/docker目录迁移

#### 首先需要停止docker服务

```text
systemctl stop docker
```

#### 通过命令df -h去选择磁盘一个大的空间

#### 创建新的docker目录

```text
# 参数-p确保目录名称存在，如果目录不存在就创建
mkdir -p /data/docker/lib
```

#### 开始迁移

```text
# 先确认是否安装rsync
# -a:归档模式，表示递归传输并且保持文件属性
# -v:显示rsync过程中详细信息
# -p:显示文件传输的进度信息
# -z:传输时进行压缩提高效率
rsync -avzP /var/lib/docker /data/docker/lib
```

#### 指定新的docker目录

```text
vim /lib/systemd/system/docker.service
# 在vim编辑界面里，在ExecStart加入（再起一行）
--graph=/data/docker/lib/docker 
```

#### 重启docker

```text
systemctl daemon-reload
systemctl restart docker
systemctl enable docker
```

#### 删除旧有的/var/lib/docker目录

```text
rm -rf /var/lib/docker
```

## 卸载Docker

```text
yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-selinux \
                  docker-engine-selinux \
                  docker-engine

rm -rf /etc/systemd/system/docker.service.d

rm -rf /var/lib/docker

rm -rf /var/run/docker
```