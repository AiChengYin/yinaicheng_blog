(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{565:function(s,l,e){"use strict";e.r(l);var a=e(8),n=Object(a.a)({},(function(){var s=this,l=s._self._c;return l("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[l("h1",{attrs:{id:"mysql日志"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#mysql日志"}},[s._v("#")]),s._v(" MySQL日志")]),s._v(" "),l("h2",{attrs:{id:"开启日志"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#开启日志"}},[s._v("#")]),s._v(" 开启日志")]),s._v(" "),l("p",[s._v('为了记录MySQL的增删改查SQL日志，我们可以使用MySQL提供的"general_log"和"slow_query_log"两种日志记录方式。')]),s._v(" "),l("ol",[l("li",[s._v("general_log记录方式")])]),s._v(" "),l("p",[s._v("打开MySQL的配置文件my.cnf，在[mysqld]下添加如下两行：")]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("general_log=ON\ngeneral_log_file=/var/log/mysql/mysql.log\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br")])]),l("p",[s._v("解释")]),s._v(" "),l("div",{staticClass:"language-text line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("# 开启了 MySQL 的通用查询日志,它记录了所有数据库操作（如查询、插入、更新、删除等）所执行的 SQL 语句和相关信息，包括执行时间、查询用户、来源 IP 等，是数据库调试和性能优化时非常有用的工具\ngeneral_log=ON\n# 指定了日志输出路径和文件名\ngeneral_log_file=/var/log/mysql/mysql.log\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br")])]),l("p",[s._v("然后重启MySQL服务，即可开始记录所有的SQL执行日志，日志文件默认存储在/var/log/mysql/mysql.log。")]),s._v(" "),l("ol",{attrs:{start:"2"}},[l("li",[s._v("slow_query_log记录方式")])]),s._v(" "),l("p",[s._v("打开MySQL的配置文件my.cnf，在[mysqld]下添加如下几行：")]),s._v(" "),l("div",{staticClass:"language- line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("slow_query_log=ON\nslow_query_log_file=/var/log/mysql/mysql-slow.log\nlong_query_time=2\nlog_queries_not_using_indexes=ON\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br")])]),l("p",[s._v("解释")]),s._v(" "),l("div",{staticClass:"language-text line-numbers-mode"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[s._v("# 表示开启慢查询日志功能\nslow_query_log=ON\n# 指定了慢查询日志文件的路\nslow_query_log_file=/var/log/mysql/mysql-slow.log\n# 指定了查询语句执行时间超过 2 秒的查询被认为是慢查询，将被记录到慢查询日志中\nlong_query_time=2\n# 表示记录未使用索引的查询语句到慢查询日志中，这个选项可以帮助我们发现哪些查询需要优化索引\nlog_queries_not_using_indexes=ON\n\n")])]),s._v(" "),l("div",{staticClass:"line-numbers-wrapper"},[l("span",{staticClass:"line-number"},[s._v("1")]),l("br"),l("span",{staticClass:"line-number"},[s._v("2")]),l("br"),l("span",{staticClass:"line-number"},[s._v("3")]),l("br"),l("span",{staticClass:"line-number"},[s._v("4")]),l("br"),l("span",{staticClass:"line-number"},[s._v("5")]),l("br"),l("span",{staticClass:"line-number"},[s._v("6")]),l("br"),l("span",{staticClass:"line-number"},[s._v("7")]),l("br"),l("span",{staticClass:"line-number"},[s._v("8")]),l("br"),l("span",{staticClass:"line-number"},[s._v("9")]),l("br")])]),l("p",[s._v('其中，"slow_query_log"表示开启慢查询日志记录，"slow_query_log_file"表示日志文件存储路径，"long_query_time"表示查询时间超过多少秒才被认为是慢查询，"log_queries_not_using_indexes"表示记录未使用索引的查询语句。')]),s._v(" "),l("p",[s._v("然后重启MySQL服务，即可开始记录慢查询日志，日志文件默认存储在/var/log/mysql/mysql-slow.log。")]),s._v(" "),l("p",[s._v("需要注意的是，开启SQL日志记录会对MySQL的性能产生一定的影响，因此在生产环境中需要慎重考虑。同时，日志文件也需要定期清理，避免占用过多磁盘空间。")])])}),[],!1,null,null,null);l.default=n.exports}}]);